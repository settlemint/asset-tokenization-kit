# Default values for postgresql chart
# This is a YAML-formatted file.

# -- (object) Image configuration
image:
  # -- (string) Image registry
  registry: docker.io
  # -- (string) Image repository
  repository: postgres
  # -- (string) Image tag
  tag: "18.0-alpine"
  # -- (string) Image pull policy
  pullPolicy: IfNotPresent

# -- (object) PostgreSQL configuration
postgresql:
  # -- (string) Default superuser username
  username: postgres
  # -- (string) Default superuser password
  password: atk
  # -- (string) Default database name
  database: postgres

# -- (object) Resource configuration
resources:
  # -- (object) Resource requests
  requests:
    # -- (string) Memory request
    memory: "256Mi"
    # -- (string) CPU request
    cpu: "80m"
  # -- (object) Resource limits
  limits:
    # -- (string) Memory limit
    memory: "512Mi"
    # -- (string) CPU limit
    cpu: "480m"

# -- (object) Persistence configuration
persistence:
  # -- (bool) Enable persistence
  enabled: true
  # -- (string) Storage class
  storageClass: ""
  # -- (list) Access modes
  accessModes:
    - ReadWriteOnce
  # -- (string) Storage size
  size: 8Gi

# -- (object) Service configuration
service:
  # -- (string) Service type
  type: ClusterIP
  # -- (int) Service port
  port: 5432
  # -- (int) Target port
  targetPort: 5432

# -- (object) Pod security context
podSecurityContext: {}

# -- (object) Container security context
securityContext: {}

# -- Pod disruption budget configuration (object)
podDisruptionBudget:
  # -- Enable pod disruption budget (bool)
  enabled: false
  # -- Minimum number of available pods (int)
  minAvailable: 1

# -- Node labels for pod assignment (object)
nodeSelector: {}
# -- Tolerations for pod assignment (list)
tolerations: []
# -- Affinity for pod assignment (object)
affinity: {}

# -- Database initialization configuration (object)
initdb:
  # -- (object) Database initialization scripts
  scripts:
    # -- (string) SQL script to create databases and users for all ATK services
    create_databases.sql: |
      -- Create databases and users for all ATK services
      CREATE DATABASE blockscout;
      CREATE USER blockscout WITH PASSWORD 'atk' SUPERUSER;
      GRANT ALL PRIVILEGES ON DATABASE blockscout TO blockscout;
      \c blockscout;
      GRANT ALL ON SCHEMA public TO blockscout;

      \c postgres;
      CREATE DATABASE thegraph WITH ENCODING 'UTF8' LC_COLLATE='C' LC_CTYPE='C' TEMPLATE template0;
      CREATE USER thegraph WITH PASSWORD 'atk' SUPERUSER;
      GRANT ALL PRIVILEGES ON DATABASE thegraph TO thegraph;
      \c thegraph;
      GRANT ALL ON SCHEMA public TO thegraph;

      \c postgres;
      CREATE DATABASE hasura;
      CREATE USER hasura WITH PASSWORD 'atk' SUPERUSER;
      GRANT ALL PRIVILEGES ON DATABASE hasura TO hasura;
      \c hasura;
      GRANT ALL ON SCHEMA public TO hasura;

      \c postgres;
      CREATE DATABASE portal;
      CREATE USER portal WITH PASSWORD 'atk' SUPERUSER;
      GRANT ALL PRIVILEGES ON DATABASE portal TO portal;
      \c portal;
      GRANT ALL ON SCHEMA public TO portal;

      \c postgres;
      CREATE DATABASE txsigner;
      CREATE USER txsigner WITH PASSWORD 'atk' SUPERUSER;
      GRANT ALL PRIVILEGES ON DATABASE txsigner TO txsigner;
      \c txsigner;
      GRANT ALL ON SCHEMA public TO txsigner;

# -- PostgreSQL configuration parameters (object)
postgresql_conf:
  # -- Maximum number of concurrent connections (int)
  max_connections: 1000
  # -- Amount of memory dedicated to PostgreSQL to use for caching data (string)
  shared_buffers: 256MB
  # -- Planner's assumption about the effective size of the disk cache (string)
  effective_cache_size: 1GB
  # -- (string) Specifies the maximum amount of memory for maintenance operations
  maintenance_work_mem: 64MB
  # -- (float) Target for completion of checkpoint processing
  checkpoint_completion_target: 0.9
  # -- (string) Amount of memory used in shared memory for WAL data
  wal_buffers: 16MB
  # -- (int) Default statistics target for table columns
  default_statistics_target: 100
  # -- (float) Planner's assumption about the cost of a non-sequentially-fetched disk page
  random_page_cost: 1.1
  # -- (int) Number of concurrent disk I/O operations
  effective_io_concurrency: 200
  # -- (string) Amount of memory to be used by internal sort operations and hash tables
  work_mem: 4MB
  # -- (string) Minimum size to which the WAL will shrink
  min_wal_size: 1GB
  # -- (string) Maximum size to which the WAL will grow during automatic checkpoints
  max_wal_size: 4GB

# -- (object) Common labels to add to all PostgreSQL resources
commonLabels:
  kots.io/app-slug: settlemint-atk
  app.kubernetes.io/managed-by: helm

# -- String to fully override common.names.fullname (string)
fullnameOverride: postgresql
