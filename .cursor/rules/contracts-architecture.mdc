---
description: 
globs: *.sol
alwaysApply: false
---
# Smart Contract Architecture

The ATK implementation contracts follow the SMART protocol, all are located in
`@kit/contracts/contracts/`.

### 1. Protocol (SMART) vs Implementation (ATK)

- The **SMART** contracts represent the generic, reusable **protocol layer** that defines standards and core functionality.

  - Located under `@kit/contracts/contracts/smart/`
  - Use the `SMART` prefix in contract names.

- The **ATK** contracts are **project-specific implementations** built on top of the SMART protocol.
  - Located under `@kit/contracts/contracts/system/` and `@kit/contracts/contracts/assets/`
  - Use the `ATK` prefix in contract names to distinguish them from the generic SMART protocol contracts.

#### Examples

- `kit/contracts/contracts/smart/SMARTGovernance.sol` ✅
- `kit/contracts/contracts/ATKToken.sol` ✅
- `kit/contracts/contracts/SMARTImplementation.sol` ❌ (should not use `SMART` prefix outside `/smart`)
- `kit/contracts/contracts/smart/ATKToken.sol` ❌ (should not use `ATK` prefix inside `/smart`)

### 2. Factory Pattern

Each asset type has a factory contract that deploys asset instances.

- Factories: `ATKBondFactory`, `ATKEquityFactory`, `ATKStableCoinFactory`, etc.
- Located in
  `@kit/contracts/contracts/assets/`

### 3. Proxy Pattern

All assets use upgradeable proxies, allowing for implementation upgrades while
maintaining state.

- Example: `ATKBondProxy`, `ATKStableCoinProxy`, etc.

### 4. Extension System

Modular features are implemented via extensions defined in the SMART protocol.

- Examples: `SMARTBurnable`, `SMARTCapped`, `SMARTCollateral`, `SMARTPausable`, etc.
- Located in
  `@kit/contracts/contracts/smart/extensions/`

### 5. Compliance System

The system uses ERC-3643 for compliance, with implementation-specific contracts
in the ATK system.

- SMART standard compliance interfaces and modules are in
  `@kit/contracts/contracts/smart/`.
- ATK-specific compliance implementation contracts (e.g., `ATKIdentityRegistry`, `ATKTrustedIssuersRegistry`) are in
  `@kit/contracts/contracts/system/`.

## Contract Addresses

The system uses deterministic addresses for factory contracts:

- **Bond Factory**: `0x5e771e1417100000000000000000000000000004`
- **Cryptocurrency Factory**: `0x5e771e1417100000000000000000000000000001`
- **Equity Factory**: `0x5e771e1417100000000000000000000000000003`
- **Stable Coin Factory**: `0x5e771e1417100000000000000000000000000002`
- **Fund Factory**: `0x5e771e1417100000000000000000000000000005`
- **Deposit Factory**: `0x5e771e1417100000000000000000000000000007`
